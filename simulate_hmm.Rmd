---
title: "Simulate HMMs"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(bayesdfa)
```

## Simulate data

First initialize the transition matrix for the HMM. Rows sum to 1, representing the probability of transitioning to other states or remaining in the current (diagonal). 

```{r}
n_state = 3
p_change = 0.1
trans_matrix = matrix(p_change/2, n_state, n_state)
diag(trans_matrix) = 1 - p_change
print(trans_matrix)

u = c(0, 5, 1)
```

Now simulate time series using the same HMM. 

```{r}
n_sims = 100
n_t = 50
sigma = 0.2

for(i in 1:n_sims) {
  # simulate latent regimes
  x = sample(1:n_state, size=1)
  for(t in 2:n_t) x[t] = sample(1:n_state, size=1, prob = trans_matrix[x[t-1],])
  # simulate observed data
  y = rnorm(n_t, u[x], sigma)

  fit = find_regimes(y)
  
}
```

